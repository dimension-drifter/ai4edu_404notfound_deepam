<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepAM â€” Student Engagement Detection</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

        *{margin:0;padding:0;box-sizing:border-box;}

        :root{
            --bg:#0a0d12;
            --bg2:#10151d;
            --card:#151b27;
            --elevated:#1c2435;
            --border:#1e2940;
            --text:#e4e9f1;
            --dim:#6b7a90;
            --accent:#3b82f6;
            --accent-soft:rgba(59,130,246,.1);
            --green:#22c55e;
            --green-soft:rgba(34,197,94,.1);
            --orange:#f59e0b;
            --orange-soft:rgba(245,158,11,.1);
            --red:#ef4444;
            --purple:#a855f7;
            --purple-soft:rgba(168,85,247,.1);
            --cyan:#06b6d4;
            --cyan-soft:rgba(6,182,212,.1);
            --nav-bg:rgba(10,13,18,.8);
        }
        [data-theme="light"]{
            --bg:#f4f6f9;
            --bg2:#eaecf1;
            --card:#ffffff;
            --elevated:#edf0f5;
            --border:#d4d9e3;
            --text:#141b2a;
            --dim:#5c6878;
            --accent:#2563eb;
            --accent-soft:rgba(37,99,235,.08);
            --green:#16a34a;
            --green-soft:rgba(22,163,74,.08);
            --orange:#d97706;
            --orange-soft:rgba(217,119,6,.08);
            --red:#dc2626;
            --purple:#9333ea;
            --purple-soft:rgba(147,51,234,.08);
            --cyan:#0891b2;
            --cyan-soft:rgba(8,145,178,.08);
            --nav-bg:rgba(244,246,249,.85);
        }

        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6;overflow-x:hidden;}

        /* === NAV === */
        .nav{position:fixed;top:0;left:0;right:0;z-index:100;background:var(--nav-bg);backdrop-filter:blur(18px);border-bottom:1px solid var(--border);height:54px;display:flex;align-items:center;justify-content:space-between;padding:0 28px;}
        .nav-logo{font-weight:700;font-size:14px;letter-spacing:1.4px;text-transform:uppercase;color:var(--accent);}
        .nav-logo span{color:var(--dim);font-weight:400;}
        .nav-right{display:flex;align-items:center;gap:14px;}
        .nav-back{display:none;background:none;border:1px solid var(--border);color:var(--text);border-radius:8px;padding:6px 14px;font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;transition:.2s;}
        .nav-back:hover{border-color:var(--accent);color:var(--accent);}
        .theme-btn{width:36px;height:36px;border-radius:9px;border:1px solid var(--border);background:var(--card);color:var(--text);cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s;}
        .theme-btn:hover{border-color:var(--accent);}
        .theme-btn svg{width:16px;height:16px;}
        .theme-btn .sun{display:none;}
        [data-theme="light"] .theme-btn .moon{display:none;}
        [data-theme="light"] .theme-btn .sun{display:block;}

        /* === PAGE VIEWS === */
        .page{display:none;min-height:100vh;}
        .page.active{display:block;}

        /* === LANDING === */
        .landing{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:100px 24px 60px;min-height:100vh;}
        .landing-badge{display:inline-flex;align-items:center;gap:7px;background:var(--accent-soft);border:1px solid rgba(59,130,246,.2);border-radius:50px;padding:5px 16px;font-size:11px;font-weight:500;color:var(--accent);margin-bottom:36px;letter-spacing:.4px;}
        .landing-badge .dot{width:5px;height:5px;background:var(--green);border-radius:50%;animation:pulse 2s infinite;}
        @keyframes pulse{0%,100%{opacity:1;}50%{opacity:.3;}}

        .landing h1{font-size:clamp(38px,5.5vw,64px);font-weight:800;line-height:1.08;letter-spacing:-1.5px;margin-bottom:18px;}
        .landing h1 .grad{background:linear-gradient(135deg,#3b82f6,#06b6d4,#a855f7);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
        .landing-sub{font-size:16px;color:var(--dim);max-width:520px;margin-bottom:52px;line-height:1.7;}

        /* stats row */
        .stats{display:flex;gap:40px;flex-wrap:wrap;justify-content:center;margin-bottom:56px;}
        .stat{text-align:center;}
        .stat-num{font-size:30px;font-weight:700;font-family:'JetBrains Mono',monospace;}
        .stat-lbl{font-size:11px;color:var(--dim);text-transform:uppercase;letter-spacing:1px;margin-top:2px;}

        /* model cards */
        .models-row{display:flex;gap:14px;flex-wrap:wrap;justify-content:center;margin-bottom:56px;max-width:900px;}
        .model-chip{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px 22px;text-align:left;min-width:155px;transition:.25s;}
        .model-chip:hover{border-color:rgba(59,130,246,.3);transform:translateY(-2px);}
        .model-chip .mc-num{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--dim);letter-spacing:1px;margin-bottom:6px;}
        .model-chip .mc-name{font-size:13px;font-weight:600;margin-bottom:4px;}
        .model-chip .mc-tag{font-size:10px;font-weight:500;padding:2px 8px;border-radius:4px;display:inline-block;}

        /* try now button */
        .try-btn{display:inline-flex;align-items:center;gap:10px;padding:16px 42px;border:none;border-radius:14px;background:linear-gradient(135deg,var(--accent),#6366f1);color:#fff;font-family:'Inter',sans-serif;font-size:16px;font-weight:700;cursor:pointer;letter-spacing:.3px;transition:.25s;box-shadow:0 4px 24px rgba(59,130,246,.25);}
        .try-btn:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(59,130,246,.35);}
        .try-btn svg{width:20px;height:20px;}
        .landing-hint{margin-top:16px;font-size:12px;color:var(--dim);}

        /* tech strip */
        .tech-strip{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:48px;padding-top:40px;border-top:1px solid var(--border);max-width:620px;}
        .tech-pill{font-size:11px;font-weight:500;color:var(--dim);background:var(--card);border:1px solid var(--border);padding:5px 14px;border-radius:6px;}

        /* === DEMO PAGE === */
        .demo-page{padding:74px 24px 60px;}
        .demo-inner{max-width:1080px;margin:0 auto;}
        .demo-head{text-align:center;margin-bottom:40px;}
        .demo-head h2{font-size:28px;font-weight:700;letter-spacing:-.5px;margin-bottom:8px;}
        .demo-head p{color:var(--dim);font-size:14px;max-width:480px;margin:0 auto;}

        .demo-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px;align-items:start;}
        @media(max-width:820px){.demo-grid{grid-template-columns:1fr;}}

        /* upload zone */
        .upload-zone{background:var(--card);border:2px dashed var(--border);border-radius:16px;padding:44px 28px;text-align:center;cursor:pointer;transition:.25s;position:relative;overflow:hidden;}
        .upload-zone:hover,.upload-zone.dragover{border-color:var(--accent);background:var(--accent-soft);}
        .upload-zone .up-icon{width:52px;height:52px;border-radius:13px;background:var(--accent-soft);display:flex;align-items:center;justify-content:center;margin:0 auto 16px;}
        .upload-zone h4{font-size:15px;font-weight:600;margin-bottom:6px;}
        .upload-zone p{font-size:12px;color:var(--dim);}
        .upload-zone .file-hint{margin-top:12px;font-size:10px;color:var(--dim);background:var(--elevated);display:inline-block;padding:3px 10px;border-radius:5px;}
        .upload-zone input[type="file"]{position:absolute;inset:0;opacity:0;cursor:pointer;}

        .or-sep{text-align:center;margin:16px 0;font-size:11px;color:var(--dim);font-weight:500;text-transform:uppercase;letter-spacing:1.5px;}

        .cam-btn{width:100%;padding:13px;border-radius:11px;border:1px solid var(--border);background:var(--card);color:var(--text);font-family:'Inter',sans-serif;font-size:13px;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:9px;transition:.25s;}
        .cam-btn:hover{border-color:var(--cyan);background:var(--cyan-soft);}
        .cam-btn svg{width:16px;height:16px;}

        .preview-box{display:none;margin-top:14px;border-radius:12px;overflow:hidden;border:1px solid var(--border);background:#000;position:relative;}
        .preview-box video{width:100%;display:block;border-radius:12px;}
        .preview-box .rec{position:absolute;top:10px;left:10px;background:var(--red);color:#fff;font-size:10px;font-weight:600;padding:2px 9px;border-radius:4px;display:none;align-items:center;gap:4px;animation:recP 1s infinite;}
        @keyframes recP{0%,100%{opacity:1;}50%{opacity:.4;}}
        .preview-box .tmr{position:absolute;top:10px;right:10px;color:#fff;font-family:'JetBrains Mono',monospace;font-size:13px;font-weight:600;background:rgba(0,0,0,.5);padding:2px 9px;border-radius:5px;display:none;}

        .run-btn{width:100%;padding:15px;margin-top:14px;border:none;border-radius:11px;background:linear-gradient(135deg,var(--accent),#6366f1);color:#fff;font-family:'Inter',sans-serif;font-size:14px;font-weight:700;cursor:pointer;transition:.2s;display:none;}
        .run-btn:hover{opacity:.9;transform:translateY(-1px);}
        .run-btn:disabled{opacity:.45;cursor:not-allowed;transform:none;}

        /* results panel */
        .results{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden;}
        .results-top{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
        .results-top h4{font-size:14px;font-weight:600;}
        .badge{font-size:11px;font-weight:500;padding:3px 10px;border-radius:5px;}
        .badge.wait{background:var(--elevated);color:var(--dim);}
        .badge.proc{background:var(--orange-soft);color:var(--orange);}
        .badge.ok{background:var(--green-soft);color:var(--green);}
        .results-body{padding:22px;}

        /* placeholder */
        .r-placeholder{text-align:center;padding:56px 16px;color:var(--dim);font-size:12px;}
        .r-placeholder svg{width:44px;height:44px;margin-bottom:14px;opacity:.3;}

        /* processing */
        .r-processing{display:none;text-align:center;padding:44px 16px;}
        .spinner{width:46px;height:46px;border:3px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 18px;}
        @keyframes spin{to{transform:rotate(360deg);}}
        .r-processing .pt{font-size:14px;font-weight:600;margin-bottom:4px;}
        .r-processing .ps{font-size:11px;color:var(--dim);}
        .steps{margin-top:20px;text-align:left;display:inline-block;}
        .step{display:flex;align-items:center;gap:9px;padding:5px 0;font-size:12px;color:var(--dim);transition:.3s;}
        .step.on{color:var(--text);}
        .step.done{color:var(--green);}
        .step .sd{width:7px;height:7px;border-radius:50%;background:var(--border);flex-shrink:0;transition:.3s;}
        .step.on .sd{background:var(--accent);}
        .step.done .sd{background:var(--green);}

        /* output */
        .r-output{display:none;}
        .verdict{text-align:center;padding:18px;margin-bottom:18px;border-radius:11px;background:var(--elevated);}
        .verdict .vl{font-size:11px;text-transform:uppercase;letter-spacing:1.5px;color:var(--dim);margin-bottom:6px;}
        .verdict .vv{font-size:26px;font-weight:800;}
        .verdict .vc{font-size:12px;color:var(--dim);margin-top:3px;}

        .mgrid{display:grid;grid-template-columns:1fr 1fr;gap:9px;}
        @media(max-width:480px){.mgrid{grid-template-columns:1fr;}}
        .mcard{background:var(--elevated);border-radius:9px;padding:14px;}
        .mcard .mn{font-size:10px;text-transform:uppercase;letter-spacing:.7px;color:var(--dim);margin-bottom:5px;}
        .mcard .mv{font-family:'JetBrains Mono',monospace;font-size:16px;font-weight:700;}
        .mcard .mb{height:3px;border-radius:2px;background:var(--border);margin-top:9px;overflow:hidden;}
        .mcard .mbf{height:100%;border-radius:2px;transition:width 1s ease;}

        .pgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:9px;margin-top:14px;}
        @media(max-width:480px){.pgrid{grid-template-columns:1fr 1fr;}}
        .pitem{background:var(--elevated);border-radius:7px;padding:10px;text-align:center;}
        .pitem .pv{font-family:'JetBrains Mono',monospace;font-size:15px;font-weight:600;}
        .pitem .pl{font-size:9px;color:var(--dim);margin-top:1px;text-transform:uppercase;letter-spacing:.4px;}

        .reset-btn{width:100%;margin-top:18px;padding:11px;border-radius:9px;border:1px solid var(--border);background:var(--elevated);color:var(--text);font-family:'Inter',sans-serif;font-size:12px;font-weight:600;cursor:pointer;transition:.2s;}
        .reset-btn:hover{border-color:var(--accent);}

        /* footer */
        .footer{border-top:1px solid var(--border);padding:32px 24px;text-align:center;color:var(--dim);font-size:12px;}

        @media(max-width:768px){
            .models-row{gap:10px;}
            .model-chip{min-width:130px;padding:12px 16px;}
            .stats{gap:24px;}
        }
    </style>
</head>
<body>

    <!-- Nav -->
    <nav class="nav">
        <div class="nav-logo">DeepAM <span>/ 404NotFound</span></div>
        <div class="nav-right">
            <button class="nav-back" id="backBtn" onclick="showPage('landing')">&#8592; Back</button>
            <button class="theme-btn" id="themeBtn">
                <svg class="moon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
                <svg class="sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            </button>
        </div>
    </nav>

    <!-- ===== PAGE 1: LANDING ===== -->
    <div class="page active" id="pageLanding">
        <div class="landing">
            <div class="landing-badge">
                <span class="dot"></span>
                AI4Edu Hackathon 2025 &bull; Team 404NotFound
            </div>

            <h1>Deep <span class="grad">Attention</span><br>Monitoring</h1>
            <p class="landing-sub">
                Real-time student engagement detection using deep learning.
                We combine facial video analysis with physiological signals (rPPG)
                to classify attention levels â€” trained overnight on 5 specialized models.
            </p>

            <div class="stats">
                <div class="stat">
                    <div class="stat-num" style="color:var(--green);">5</div>
                    <div class="stat-lbl">Models Trained</div>
                </div>
                <div class="stat">
                    <div class="stat-num" style="color:var(--accent);">5</div>
                    <div class="stat-lbl">Tasks Completed</div>
                </div>
                <div class="stat">
                    <div class="stat-num" style="color:var(--cyan);">80%</div>
                    <div class="stat-lbl">Best Accuracy</div>
                </div>
                <div class="stat">
                    <div class="stat-num" style="color:var(--purple);">3</div>
                    <div class="stat-lbl">Modalities Fused</div>
                </div>
            </div>

            <!-- 5 model cards -->
            <div class="models-row">
                <div class="model-chip">
                    <div class="mc-num">MODEL 01</div>
                    <div class="mc-name">Binary Classifier</div>
                    <span class="mc-tag" style="background:var(--green-soft);color:var(--green);">73.3% Acc</span>
                </div>
                <div class="model-chip">
                    <div class="mc-num">MODEL 02</div>
                    <div class="mc-name">Multi-Class (4)</div>
                    <span class="mc-tag" style="background:var(--orange-soft);color:var(--orange);">4 Levels</span>
                </div>
                <div class="model-chip">
                    <div class="mc-num">MODEL 03</div>
                    <div class="mc-name">rPPG Physio</div>
                    <span class="mc-tag" style="background:var(--cyan-soft);color:var(--cyan);">POS Algo</span>
                </div>
                <div class="model-chip">
                    <div class="mc-num">MODEL 04</div>
                    <div class="mc-name">Multimodal Fusion</div>
                    <span class="mc-tag" style="background:var(--purple-soft);color:var(--purple);">80% Acc</span>
                </div>
                <div class="model-chip">
                    <div class="mc-num">MODEL 05</div>
                    <div class="mc-name">Ablation Best</div>
                    <span class="mc-tag" style="background:var(--accent-soft);color:var(--accent);">Fused</span>
                </div>
            </div>

            <button class="try-btn" onclick="showPage('demo')">
                Try It Now
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>
            </button>
            <div class="landing-hint">Upload a 5â€“10 sec video or use your webcam</div>

            <div class="tech-strip">
                <span class="tech-pill">PyTorch</span>
                <span class="tech-pill">ResNet-18</span>
                <span class="tech-pill">BiLSTM</span>
                <span class="tech-pill">MediaPipe</span>
                <span class="tech-pill">rPPG / POS</span>
                <span class="tech-pill">OpenCV</span>
                <span class="tech-pill">scikit-learn</span>
            </div>
        </div>
    </div>

    <!-- ===== PAGE 2: DEMO ===== -->
    <div class="page" id="pageDemo">
        <div class="demo-page">
            <div class="demo-inner">
                <div class="demo-head">
                    <h2>Live Engagement Analysis</h2>
                    <p>Upload a short clip or record from your webcam â€” our 5 models will analyze it in real time.</p>
                </div>

                <div class="demo-grid">
                    <!-- Left: input -->
                    <div>
                        <div class="upload-zone" id="uploadZone">
                            <div class="up-icon">
                                <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                            </div>
                            <h4>Drop your video here</h4>
                            <p>or click to browse files</p>
                            <span class="file-hint">.mp4 .avi .mov &bull; 5â€“10 sec &bull; max 50 MB</span>
                            <input type="file" id="fileInput" accept="video/*">
                        </div>

                        <div class="or-sep">â€” or â€”</div>

                        <button class="cam-btn" id="camBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg>
                            Record from Webcam (10s)
                        </button>

                        <div class="preview-box" id="prevBox">
                            <video id="prevVid" playsinline></video>
                            <div class="rec" id="recBadge"><span style="width:5px;height:5px;border-radius:50%;background:#fff;display:inline-block;"></span> REC</div>
                            <div class="tmr" id="tmr">0:00</div>
                        </div>

                        <button class="run-btn" id="runBtn">Analyze Engagement</button>
                    </div>

                    <!-- Right: results -->
                    <div class="results">
                        <div class="results-top">
                            <h4>Analysis Results</h4>
                            <span class="badge wait" id="sBadge">Waiting</span>
                        </div>
                        <div class="results-body">
                            <div class="r-placeholder" id="rPlaceholder">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="12" cy="10" r="3"/><path d="M6 22v-1a6 6 0 0112 0v1"/></svg>
                                <p>Upload a video or record via webcam<br>to see predictions from all 5 models.</p>
                            </div>

                            <div class="r-processing" id="rProc">
                                <div class="spinner"></div>
                                <div class="pt">Running inference pipeline...</div>
                                <div class="ps">Processing through 5 trained models</div>
                                <div class="steps" id="steps">
                                    <div class="step" data-s="0"><span class="sd"></span> Extracting face frames (MediaPipe)</div>
                                    <div class="step" data-s="1"><span class="sd"></span> ResNet-18 visual features</div>
                                    <div class="step" data-s="2"><span class="sd"></span> POS rPPG physiological analysis</div>
                                    <div class="step" data-s="3"><span class="sd"></span> BiLSTM temporal modeling</div>
                                    <div class="step" data-s="4"><span class="sd"></span> Multimodal fusion &amp; classification</div>
                                </div>
                            </div>

                            <div class="r-output" id="rOutput">
                                <div class="verdict" id="verdictBox">
                                    <div class="vl">Engagement Prediction</div>
                                    <div class="vv" id="vText"></div>
                                    <div class="vc" id="vConf"></div>
                                </div>
                                <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.8px;color:var(--dim);margin-bottom:10px;">Model Outputs</div>
                                <div class="mgrid" id="mGrid"></div>
                                <div style="font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.8px;color:var(--dim);margin-top:16px;margin-bottom:10px;">Physiological Signals (rPPG)</div>
                                <div class="pgrid" id="pGrid"></div>
                                <button class="reset-btn" id="resetBtn">Reset &amp; Try Again</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        DeepAM â€” Deep Attention Monitoring &middot; AI4Edu Hackathon 2025 &middot; Team 404NotFound
    </footer>

    <script>
        /* ===== PAGE SWITCHING ===== */
        function showPage(id){
            document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
            document.getElementById(id==='demo'?'pageDemo':'pageLanding').classList.add('active');
            document.getElementById('backBtn').style.display=id==='demo'?'inline-flex':'none';
            window.scrollTo(0,0);
        }

        /* ===== THEME ===== */
        (function(){
            const btn=document.getElementById('themeBtn');
            if(localStorage.getItem('deepam-theme')==='light') document.documentElement.setAttribute('data-theme','light');
            btn.onclick=()=>{
                const light=document.documentElement.getAttribute('data-theme')==='light';
                if(light){document.documentElement.removeAttribute('data-theme');localStorage.setItem('deepam-theme','dark');}
                else{document.documentElement.setAttribute('data-theme','light');localStorage.setItem('deepam-theme','light');}
            };
        })();

        /* ===== DEMO LOGIC ===== */
        (function(){
            const uploadZone=document.getElementById('uploadZone');
            const fileInput=document.getElementById('fileInput');
            const camBtn=document.getElementById('camBtn');
            const prevBox=document.getElementById('prevBox');
            const prevVid=document.getElementById('prevVid');
            const recBadge=document.getElementById('recBadge');
            const tmr=document.getElementById('tmr');
            const runBtn=document.getElementById('runBtn');
            const sBadge=document.getElementById('sBadge');
            const rPlaceholder=document.getElementById('rPlaceholder');
            const rProc=document.getElementById('rProc');
            const stepsEl=document.getElementById('steps').children;
            const rOutput=document.getElementById('rOutput');
            const vText=document.getElementById('vText');
            const vConf=document.getElementById('vConf');
            const mGrid=document.getElementById('mGrid');
            const pGrid=document.getElementById('pGrid');
            const resetBtn=document.getElementById('resetBtn');

            let ready=false,stream=null,recorder=null,chunks=[];
            let videoFile=null,webcamBlob=null;

            uploadZone.addEventListener('dragover',e=>{e.preventDefault();uploadZone.classList.add('dragover');});
            uploadZone.addEventListener('dragleave',()=>uploadZone.classList.remove('dragover'));
            uploadZone.addEventListener('drop',e=>{e.preventDefault();uploadZone.classList.remove('dragover');if(e.dataTransfer.files[0]){videoFile=e.dataTransfer.files[0];webcamBlob=null;preview(URL.createObjectURL(e.dataTransfer.files[0]));}});

            fileInput.addEventListener('change',()=>{
                const f=fileInput.files[0];
                if(!f)return;
                videoFile=f;webcamBlob=null;
                preview(URL.createObjectURL(f));
            });

            function preview(src){
                prevBox.style.display='block';
                prevVid.src=src;prevVid.muted=true;prevVid.loop=true;prevVid.play();
                runBtn.style.display='block';ready=true;
                recBadge.style.display='none';tmr.style.display='none';
            }

            camBtn.addEventListener('click',async()=>{
                try{
                    stream=await navigator.mediaDevices.getUserMedia({video:true,audio:false});
                    prevBox.style.display='block';prevVid.srcObject=stream;prevVid.muted=true;prevVid.play();
                    recBadge.style.display='flex';tmr.style.display='block';
                    camBtn.disabled=true;camBtn.textContent='Recording...';
                    chunks=[];
                    recorder=new MediaRecorder(stream);
                    recorder.ondataavailable=e=>{if(e.data.size>0)chunks.push(e.data);};
                    recorder.onstop=()=>{
                        const blob=new Blob(chunks,{type:'video/webm'});
                        webcamBlob=blob;videoFile=null;
                        stream.getTracks().forEach(t=>t.stop());prevVid.srcObject=null;
                        preview(URL.createObjectURL(blob));
                        camBtn.disabled=false;
                        camBtn.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 7l-7 5 7 5V7z"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg> Record from Webcam (10s)';
                    };
                    recorder.start();
                    let sec=0;
                    const iv=setInterval(()=>{sec++;tmr.textContent='0:'+String(sec).padStart(2,'0');if(sec>=10){clearInterval(iv);recorder.stop();}},1000);
                }catch(e){alert('Camera access denied or unavailable.');}
            });

            runBtn.addEventListener('click',()=>{if(!ready)return;analyze();});

            async function analyze(){
                runBtn.disabled=true;
                rPlaceholder.style.display='none';rOutput.style.display='none';
                rProc.style.display='block';
                sBadge.className='badge proc';sBadge.textContent='Processing...';
                Array.from(stepsEl).forEach(s=>s.classList.remove('on','done'));

                let step=0;
                const stepIv=setInterval(()=>{
                    if(step>0){stepsEl[step-1].classList.remove('on');stepsEl[step-1].classList.add('done');}
                    if(step<stepsEl.length){stepsEl[step].classList.add('on');step++;}
                    else clearInterval(stepIv);
                },1500);

                const fd=new FormData();
                if(videoFile)fd.append('video',videoFile,videoFile.name||'upload.mp4');
                else if(webcamBlob)fd.append('video',webcamBlob,'webcam.webm');
                else{clearInterval(stepIv);rProc.style.display='none';rPlaceholder.style.display='block';rPlaceholder.innerHTML='<p style="color:var(--red)">No video selected</p>';runBtn.disabled=false;return;}

                try{
                    const resp=await fetch('/api/analyze',{method:'POST',body:fd});
                    const data=await resp.json();
                    clearInterval(stepIv);
                    Array.from(stepsEl).forEach(s=>{s.classList.remove('on');s.classList.add('done');});
                    await new Promise(r=>setTimeout(r,500));
                    rProc.style.display='none';
                    if(data.success)showRealResults(data);
                    else{rPlaceholder.style.display='block';rPlaceholder.innerHTML='<p style="color:var(--red)">'+escHtml(data.error||'Inference failed')+'</p>';runBtn.disabled=false;}
                }catch(err){
                    clearInterval(stepIv);rProc.style.display='none';rPlaceholder.style.display='block';
                    rPlaceholder.innerHTML='<p style="color:var(--red)">Server connection failed.<br>Make sure <code>python app.py</code> is running.</p>';runBtn.disabled=false;
                }
            }

            function escHtml(s){return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}

            function showRealResults(data){
                rOutput.style.display='block';
                sBadge.className='badge ok';sBadge.textContent='Complete';

                const clsColors={'Distracted':'var(--red)','Disengaged':'var(--orange)','Nominally Engaged':'var(--accent)','Highly Engaged':'var(--green)','Low Attentiveness':'var(--orange)','High Attentiveness':'var(--green)'};
                let mainLabel='',mainConf=0;

                if(data.multiclass){mainLabel=data.multiclass.label;mainConf=data.multiclass.confidence;}
                else if(data.binary){mainLabel=data.binary.label;mainConf=data.binary.confidence;}

                vText.textContent=mainLabel;vText.style.color=clsColors[mainLabel]||'var(--text)';
                vConf.textContent='Confidence: '+mainConf+'%';

                let cards=[];
                if(data.binary){const b=data.binary;cards.push({n:'Binary (Task 1)',c:'var(--green)',l:b.label,pc:b.confidence});}
                if(data.multiclass){const m=data.multiclass;cards.push({n:'Multi-class (Task 2)',c:'var(--accent)',l:m.label,pc:m.confidence});if(m.probabilities){const pClr={'Distracted':'var(--red)','Disengaged':'var(--orange)','Nominally Engaged':'var(--accent)','Highly Engaged':'var(--green)'};Object.entries(m.probabilities).forEach(([cls,prob])=>{if(cls!==m.label)cards.push({n:cls,c:pClr[cls]||'var(--dim)',l:prob+'%',pc:prob});});}}
                if(data.rppg && data.rppg.sqi)cards.push({n:'rPPG Signal (Task 3)',c:'var(--cyan)',l:data.rppg.sqi+'% SQI',pc:Math.min(data.rppg.sqi,100)});

                mGrid.innerHTML=cards.map(m=>`<div class="mcard"><div class="mn">${escHtml(m.n)}</div><div class="mv" style="color:${m.c}">${escHtml(String(m.l))}</div><div class="mb"><div class="mbf" style="width:${m.pc}%;background:${m.c}"></div></div></div>`).join('');

                const rppg=data.rppg||{};
                const physio=[
                    {v:(rppg.hr_bpm||0)+' bpm',l:'Heart Rate'},
                    {v:(rppg.sdnn_ms||0)+' ms',l:'HRV (SDNN)'},
                    {v:(rppg.rmssd_ms||0)+' ms',l:'HRV (RMSSD)'},
                    {v:(rppg.lf_hf_ratio||0),l:'LF/HF Ratio'},
                    {v:(rppg.sqi||0)+'%',l:'Signal Quality'},
                    {v:(rppg.mean_ibi_ms||0)+' ms',l:'Mean IBI'}
                ];
                pGrid.innerHTML=physio.map(p=>`<div class="pitem"><div class="pv">${p.v}</div><div class="pl">${p.l}</div></div>`).join('');
            }

            resetBtn.addEventListener('click',()=>{
                ready=false;videoFile=null;webcamBlob=null;
                prevBox.style.display='none';prevVid.src='';prevVid.srcObject=null;
                runBtn.style.display='none';runBtn.disabled=false;
                rOutput.style.display='none';rProc.style.display='none';
                rPlaceholder.style.display='block';
                rPlaceholder.innerHTML='<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="2" y="2" width="20" height="20" rx="2"/><circle cx="12" cy="10" r="3"/><path d="M6 22v-1a6 6 0 0112 0v1"/></svg><p>Upload a video or record via webcam<br>to see predictions from all 5 models.</p>';
                sBadge.className='badge wait';sBadge.textContent='Waiting';
                fileInput.value='';
            });
        })();
    </script>
</body>
</html>
